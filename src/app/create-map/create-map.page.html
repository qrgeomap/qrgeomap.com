
<ion-header>

  <ion-toolbar color="dark">
      <ion-buttons slot="start"><ion-button color="light" (click)="control.back()"><ion-icon name="arrow-back"></ion-icon></ion-button></ion-buttons>    
      <ion-title>{{'CREATE_MAP'|translate}}</ion-title>
  </ion-toolbar>

</ion-header>


<ion-content>

    <div class="createmap_steps_bg"> 

        <ion-accordion-group #accordionGroup class="ion-padding">

            <ion-accordion value="1">
                <ion-item slot="header" color="dark">
                    <ion-label>1. {{'LOAD_TRACK'|translate}}</ion-label>
                </ion-item>
                <div slot="content">
                    <ion-list lines="none">
                        <ion-item>
                            <div class='fake_file_input_ion_item-btn_container-div'> 
                                <div class="fake_file_input_ion_item-btn_behind">
                                    <ion-icon class="item-icon-ionicon" name='folder-outline'></ion-icon> <span text-wrap>{{'LOAD_TRACK_FILE'|translate}}</span>
                                </div>
                                <input id="input_map_menu" style="cursor:pointer;" type="file" class="fake_file_input_ion_item-btn_transparent-input" (change)="onTrackFileSelected($event)" />
                            </div>                    
                        </ion-item>
                        <div *ngIf="track_loaded">
                            <div class="info">
                                <div><b>{{track.filename}}</b></div>
                                <div>{{'POINTS'|translate}}: {{track.points.length}}</div>
                                <div>{{'WAYPOINTS'|translate}}: {{track.waypoints.length}}</div>
                                <div>{{'TOTAL_DISTANCE'|translate}} (m): {{track.total_distance}}</div>
                                <div>{{'CUMULATIVE_ELEVATION_GAIN'|translate}} (m): {{track.cumulative_elevation_gain}}</div>
                            </div>
                        </div>
                    </ion-list>
                </div>
            </ion-accordion>
    
            <ion-accordion value="2" *ngIf="track_loaded">
                <ion-item slot="header" color="dark">
                    <ion-label>2. {{'MAP_PROVIDER'|translate}}</ion-label>
                </ion-item>
                <div slot="content">
                    <ion-list lines="full">
                        <ion-item>
                            <ion-label>{{'MAP_PROVIDER'|translate}}</ion-label>
                            <ion-select interface="popover" style='max-width: 100%;' [(ngModel)]="map_provider" (ionChange)="onChangeMapProvider()">
                                <ion-select-option value="openstreetmap">OpenStreetMap</ion-select-option>
                                <ion-select-option value="opentopomap">OpenTopoMap</ion-select-option> 
                                <ion-select-option value="cyclosm">CyclOSM</ion-select-option> 
                            </ion-select>
                        </ion-item>
                        <div class="ion-padding">
                            <ion-button (click)="getMap()">{{'GET_MAP'|translate}}</ion-button>
                        </div>
                    </ion-list>
                </div>
            </ion-accordion>
    
            <ion-accordion value="3" *ngIf="track_loaded && got_map">
                <ion-item slot="header" color="dark">
                    <ion-label>3. {{'DRAW_MAP'|translate}}...</ion-label>
                </ion-item>
                <div slot="content">
                    <ion-list lines="full">
                        <ion-item>
                            <ion-label>{{'COLOR'|translate}}</ion-label>
                            <div style="margin-top: 4px;">
                                <div *ngFor="let color of colors" class="bot_color" [style]="colorStyle(color)" (click)="setColor(color)"></div>
                            </div>
                        </ion-item>
                        <ion-item>
                            <ion-label>{{'LINE_WIDTH'|translate}}</ion-label>
                            <div style="min-width:150px;">
                                <ion-range [ticks]="true" [snaps]="true" [min]="1" [max]="5" [(ngModel)]="line_width"></ion-range>                
                            </div>
                        </ion-item>
                        <div class="points_container">
                            <div class="points_subtitle">{{'POINTS'|translate}}</div>
                            <ion-item *ngFor="let point of points">
                                <ion-input [(ngModel)]="point.name" [disabled]="!point.visible"></ion-input>
                                <ion-toggle slot="end" [(ngModel)]="point.visible"></ion-toggle>
                            </ion-item>  
                        </div>

                        <ion-item>
                            <ion-label position="stacked">{{'QR_SOURCE_LINK'|translate}}</ion-label>
                            <ion-input placeholder="" [(ngModel)]="source_link"></ion-input>
                        </ion-item>
            
                        <ion-item>
                            <ion-label position="stacked">{{'MAP_TITLE'|translate}}</ion-label>
                            <ion-input placeholder="" [(ngModel)]="map_title"></ion-input>
                        </ion-item>
            
                        <div class="ion-padding">
                            <ion-button (click)="redrawMap()">{{'REDRAW_MAP'|translate}}</ion-button>
                        </div>

                    </ion-list>
                </div>
            </ion-accordion>
    
        </ion-accordion-group>

    </div>


    <div class="createmap_map_bg ion-padding" *ngIf="imageSrc!=''">

        <img id='theImage' width="100%" src='{{ imageSrc }}'/>

        <div>
            <ion-button *ngIf="mapReady" (click)="downloadMap()">{{'DOWNLOAD'|translate}}</ion-button>
        </div>

    </div>



</ion-content>
